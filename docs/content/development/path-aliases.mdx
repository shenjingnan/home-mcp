import { Callout, Steps } from 'nextra/components'

# 路径别名使用指南

## 概述

Home-MCP 项目使用 `@/xxx` 格式的路径别名系统，以提高代码可读性和可维护性。本文档详细介绍路径别名的配置、使用方法和最佳实践。

## 为什么使用路径别名

<Callout type="info">
### 使用路径别名的好处

1. **提高可读性** - 明确显示模块的来源和层级关系
2. **便于维护** - 重构文件位置时无需修改导入路径
3. **避免歧义** - 减少与npm包名的命名冲突风险
4. **IDE支持** - 更好的智能提示和跳转功能
5. **行业标准** - 符合主流框架和工具链的实践
</Callout>

## 可用别名映射

| 别名 | 映射路径 | 说明 |
|------|----------|------|
| `@/*` | `src/*` | 根目录快速访问 |
| `@/types/*` | `src/types/*` | 类型定义目录 |
| `@/utils/*` | `src/utils/*` | 工具函数目录 |
| `@/services/*` | `src/services/*` | 服务层目录 |
| `@/mocks/*` | `src/mocks/*` | Mock 数据目录 |
| `@/test/*` | `src/test/*` | 测试配置目录 |

## 使用指南

### ✅ 推荐的用法

```typescript
// 导入服务类
import { LightService } from "@/services";

// 导入类型定义
import type { HassState, ServiceData } from "@/types";

// 导入工具函数
import { formatDate, buildPath } from "@/utils";

// 导入 Mock 数据
import { mockStates } from "@/mocks/data/states";

// 导入测试配置
import { setupTestEnvironment } from "@/test/setup";
```

### ❌ 避免的用法

```typescript
// 避免使用跨目录相对路径
import { LightService } from "../services";
import type { HassState } from "../types";

// 避免使用同级相对路径（除了特殊情况）
import { formatDate } from "./utils";
import { mockStates } from "./data/states";
```

## 例外情况

在某些特殊情况下，相对路径仍然是合适的：

1. **同文件类型的紧密相关模块**
```typescript
// light.ts 与 light.test.ts 紧密相关
import { LightService } from "./light";
```

2. **内部工具函数**
```typescript
// 同一目录下的辅助函数
import { helperFunction } from "./helpers";
```

## 配置文件

路径别名在以下配置文件中统一定义：

### TypeScript 配置
```json title="tsconfig.json"
{
  "compilerOptions": {
    "baseUrl": "./src",
    "paths": {
      "@/*": ["*"],
      "@/types/*": ["types/*"],
      "@/utils/*": ["utils/*"],
      "@/services/*": ["services/*"],
      "@/mocks/*": ["mocks/*"],
      "@/test/*": ["test/*"]
    }
  }
}
```

### Vitest 配置
```typescript title="config/vitest.config.ts"
resolve: {
  alias: {
    "@": path.resolve(__dirname, "../src"),
    "@/types": path.resolve(__dirname, "../src/types"),
    "@/utils": path.resolve(__dirname, "../src/utils"),
    "@/services": path.resolve(__dirname, "../src/services"),
    "@/mocks": path.resolve(__dirname, "../src/mocks"),
    "@/test": path.resolve(__dirname, "../src/test"),
  },
}
```

### Tsup 配置
```typescript title="config/tsup.config.ts"
esbuildOptions: (options) => {
  options.resolve = {
    ...options.resolve,
    alias: {
      "@": "./src",
      "@/types": "./src/types",
      "@/utils": "./src/utils",
      "@/services": "./src/services",
      "@/mocks": "./src/mocks",
      "@/test": "./src/test",
    },
  };
}
```

## 最佳实践

### 1. 导入顺序建议

```typescript
// 1. Node.js 内置模块
import { fs, path } from "node:fs";

// 2. 外部依赖包
import { z } from "zod";
import express from "express";

// 3. 路径别名导入（按字母顺序）
import { formatDate } from "@/utils";
import { LightService } from "@/services";
import type { HassState } from "@/types";

// 4. 相对路径导入（仅在必要时）
import { helperFunction } from "./helpers";
```

### 2. 类型导入优先

```typescript
// ✅ 推荐：使用 type 关键字导入类型
import type { HassState, ServiceData } from "@/types";

// ❌ 避免：混合导入类型和值
import { HassState, ServiceData, someFunction } from "@/types";
```

### 3. 保持一致性

在同一个文件中，对同一目录下的模块使用一致的导入方式：

```typescript
// ✅ 推荐：统一使用别名
import { UserService } from "@/services";
import { LightService } from "@/services";
import { ClimateService } from "@/services";

// ❌ 避免：混用别名和相对路径
import { UserService } from "@/services";
import { LightService } from "./services";
import { ClimateService } from "../services/climate";
```

## 迁移指南

如果你需要将现有的相对路径代码迁移到别名系统，请按以下步骤进行：

### 步骤 1：识别相对路径

```bash
# 搜索项目中的相对路径导入
grep -r "from \"\.\./" src/
grep -r "from \"\./" src/
```

### 步骤 2：替换为别名

根据文件位置选择合适的别名：

```typescript
// 之前
import { LightService } from "../services/light";
import { formatDate } from "../utils/date";

// 之后
import { LightService } from "@/services/light";
import { formatDate } from "@/utils/date";
```

### 步骤 3：验证修改

```bash
# 运行测试确保功能正常
pnpm test

# 检查构建是否成功
pnpm build

# 运行代码格式化
pnpm check:fix
```

## IDE 配置

### VS Code

确保你的 VS Code 配置支持路径别名：

```json title=".vscode/settings.json"
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "typescript.suggest.autoImports": true,
  "typescript.updateImportsOnFileMove.enabled": "always"
}
```

### WebStorm

1. 打开 Settings/Preferences
2. 导航到 Languages & Frameworks > TypeScript
3. 选择使用 TypeScript Service
4. 确保 "Use path mappings from tsconfig.json" 选项已启用

## 故障排除

### 常见问题

**Q: TypeScript 编译器报错找不到模块**
```
A: 确保 tsconfig.json 中的路径配置正确，并重启 TypeScript 服务
```

**Q: 运行时模块找不到**
```
A: 检查构建工具（tsup、vitest等）的别名配置是否与 tsconfig.json 一致
```

**Q: IDE 无法识别路径别名**
```
A: 确保你的 IDE 配置正确，并已重新加载项目
```

### 调试技巧

1. **检查配置文件**：确保所有配置文件中的别名设置一致
2. **清除缓存**：重启 TypeScript 服务或 IDE
3. **渐进式迁移**：一次只修改一个文件，逐步验证
4. **使用 IDE 功能**：利用 IDE 的自动导入和重构功能

## 总结

路径别名是提高代码质量和开发效率的重要工具。通过正确使用 `@/xxx` 格式的别名，我们可以：

- 编写更清晰、更易维护的代码
- 减少重构时的工作量
- 提高团队协作效率
- 符合现代前端开发的最佳实践

记住：**优先使用别名引用，仅在特殊情况下使用相对路径**。