# Home Assistant 服务

## 工具介绍

Home Assistant 服务工具集提供了访问 Home Assistant 核心功能的完整接口，包括系统状态检查、服务发现、配置验证等基础功能。

## 可用工具

### checkHassAPIService
检查 Home Assistant API 服务的连接状态和可用性。

**返回值：**
```json
{
  "status": "ok" | "error",
  "message": "服务状态描述",
  "version": "Home Assistant 版本"
}
```

### getConfig
获取 Home Assistant 的完整配置信息。

**返回值：**
- Home Assistant 核心配置数据
- 组件配置信息
- 系统设置参数

### getComponents
获取当前已加载的所有组件列表。

**返回值：**
```json
{
  "components": [
    "light",
    "switch",
    "sensor",
    "camera",
    ...
  ]
}
```

### getEvents
获取当前已注册的所有事件类型及其监听器数量。

**返回值：**
```json
{
  "events": [
    {
      "event": "state_changed",
      "listener_count": 15
    },
    {
      "event": "service_registered",
      "listener_count": 3
    }
  ]
}
```

### getServices
获取当前可用的所有服务列表，按域分组。

**返回值：**
```json
{
  "services": [
    {
      "domain": "light",
      "services": [
        "turn_on",
        "turn_off",
        "toggle"
      ]
    },
    {
      "domain": "switch",
      "services": [
        "turn_on",
        "turn_off",
        "toggle"
      ]
    }
  ]
}
```

## 使用示例

### 检查服务状态
```typescript
// 检查 Home Assistant API 连接
const status = await checkHassAPIService();
console.log(status.message);
```

### 获取配置信息
```typescript
// 获取系统配置
const config = await getConfig();
console.log("当前配置:", config);
```

### 查看可用服务
```typescript
// 获取所有可用服务
const services = await getServices();
services.services.forEach(domain => {
  console.log(`${domain.domain}: ${domain.services.join(", ")}`);
});
```

### 监控事件系统
```typescript
// 查看事件监听器
const events = await getEvents();
events.events.forEach(event => {
  console.log(`${event.event}: ${event.listener_count} 个监听器`);
});
```

## 注意事项

- 所有工具都需要正确的 Home Assistant 凭据配置
- 返回的数据格式与 Home Assistant REST API 保持一致
- 部分敏感信息可能会被过滤或隐藏
- 建议定期检查服务状态以确保连接稳定性

## 错误处理

常见错误及解决方案：

| 错误类型 | 原因 | 解决方案 |
|----------|------|----------|
| 连接超时 | 网络问题或 HA 服务不可用 | 检查网络连接和 HA 服务状态 |
| 认证失败 | Token 无效或过期 | 更新 HA_TOKEN 环境变量 |
| 权限不足 | 用户权限不足 | 检查 Home Assistant 用户权限配置 |